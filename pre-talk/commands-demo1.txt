#PRE-SUMMIT
#0) No Icons On Desktop - except sam-demo
#1) Chrome Zoomed in - http://127.0.0.1:3000/?left=4&right=2
#2) Everything closed.
#3) Logitech app
#4) Docker running
#5) Commands opened on Atom at bottom screen
#6) Mobile off
#7) Go code is multiplying
#8) JS code is adding
#9) Non-mirror screen + Big one on top of laptop's
#10) Adjust Command+Option+8 Zoom level


#------INITIALISE-----
#1 from VALIDATOR -- ONLY ONCE?
. ./deploy

#2 from pre-talk
. ./pre-talk-init

#3 TEST
curl https://$ID.execute-api.ap-southeast-2.amazonaws.com/Prod/?left=4&right=3

#4a. change comment to calculator.go!!
#4b. compile go binary
GOOS=linux go build calculator.go

#4c. Change Directory into demo1
cd ../demo1

#----------------------------
#5) VS Code with Terminal open on demo1 - Zoomed In. Open 2nd terminal on demo2!

#-----DEMO 1 FROM demo1/--------------------
#show artifact
echo $ARTIFACT_BUCKET

# 1. Package
aws cloudformation package --template-file template.yaml --s3-bucket $ARTIFACT_BUCKET --output-template-file ../temp/packaged-demo1.yaml

# 2. Deploy
aws cloudformation deploy --template-file ../temp/packaged-demo1.yaml --stack-name calculator-add --capabilities CAPABILITY_IAM

# -----while deploying ---
#1 show TEMPLATE template.yaml and CODE calculator.go
#mention I added some security mechanisims we'll discuss in a second.

#----- after deployed----
#1 Show CLI
#2 Say collect API ID.
. ./get-api-id

#3. TEST.
curl https://$ID.execute-api.ap-southeast-2.amazonaws.com/Prod/?left=4&right=3

#4a. Make a change! MISTAKE: SUBSTRACTION.
#4b. compile go binary
GOOS=linux go build calculator.go

#5 Try to deploy
aws cloudformation package --template-file template.yaml --s3-bucket $ARTIFACT_BUCKET --output-template-file packaged-demo1.yaml
aws cloudformation deploy --template-file ./packaged-demo1.yaml --stack-name calculator-add --capabilities CAPABILITY_IAM

## -----while deploying --- Wouldn't it be nice if there was a way to prevent?
#show template.yaml
#Lambda Traffic Shifting + CodeDeploy + SAM - DEAD SIMPLE


#-------after deployed Show failed.
#1 CLI failed.
#2 Test app - Still multiplying!
curl https://$ID.execute-api.ap-southeast-2.amazonaws.com/Prod/?left=4&right=3

#3 Display Cfn rolled back event messages.
aws cloudformation describe-stack-events --stack-name calculator | grep rollback

#4a. Fix code: ADDITION. calculator.go
#4b. compile go binary
GOOS=linux go build calculator.go

#5. Package and Deploy again.
aws cloudformation package --template-file template.yaml --s3-bucket $ARTIFACT_BUCKET --output-template-file packaged-demo1.yaml
aws cloudformation deploy --template-file ./packaged-demo1.yaml --stack-name calculator-add --capabilities CAPABILITY_IAM

#!!!!!!!!!!!!!!
